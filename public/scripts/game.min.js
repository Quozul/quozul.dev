function random_color(o,e){let i=e/2,n=e,t=[];return o.forEach((o,e)=>{let l=rand(-i,n);l=Math.floor(255-l<0?255-l+255:l),t[e]=Math.min(Math.max(o+l,0),255)}),t}function deep_compare(o,e){for(var i=0;i<o.length;i++)if(o[i]!=e[i])return!1;return!0}function randomize_colors(){color=[Math.floor(rand(0,255)),Math.floor(rand(0,255)),Math.floor(rand(0,255))];let o=Math.floor(rand(0,5));for(index in circles)if(circles.hasOwnProperty(index)){const e=circles[index];if(index==o)e.style.backgroundColor=`rgb(${color[0]}, ${color[1]}, ${color[2]})`;else{let o;do{o=random_color(color,dif),e.style.backgroundColor=`rgb(${o[0]}, ${o[1]}, ${o[2]})`}while(deep_compare(o,color))}}$("#color-code").innerHTML=`(<span class="red">${color[0]}</span>, <span class="green">${color[1]}</span>, <span class="blue">${color[2]}</span>)`}function verify_color(){if(won||clicked_colors.includes(this))return;clicks++;const o=$("#guess");if(deep_compare(this.style.backgroundColor.slice(4,-1).split(", "),color)){o.innerHTML=win_msg[Math.floor(rand(0,win_msg.length))],full_anim(),win_sound.play(),won=!0,wins++,last_color=rgbToHex(color[0],color[1],color[2]);let e=ntc.name(last_color);console.log(e);let i=$("#last-color");i.style.opacity="0",setTimeout(()=>{i.style.opacity="1",i.innerHTML=`<b>That was the color:</b>\n                <span id="copy-color" class="tooltip" onclick="copy_color_code();">\n                    <span id="copy-tooltip" class="tooltip toggle-tooltip tooltip-clickable"><span class="tooltip-text">Copy color code</span>\n                        ${e[1]} ${e[2]?"":"<h6>(approx.)</h6>"}\n                </span><span id="copied" class="tooltip-text">Copied!</span></span>`},200),null!=win_timer&&clearTimeout(win_timer),dif=Math.max(dif-1,8),win_timer=setTimeout(()=>{randomize_colors(),$("#difficulty").innerHTML=255-dif,won=!1,clicked_colors.forEach(o=>o.style.transform=""),clicked_colors=[]},1e3)}else text_anim(),wrong_sound.play(),o.innerHTML=encouraging[Math.floor(rand(0,encouraging.length))],clicked_colors.push(this),this.style.backgroundColor="#777",this.style.transform="scale(.75)";$("#win-rate").innerHTML=Math.round(wins/clicks*100),null!=guess_timer&&clearTimeout(guess_timer),guess_timer=setTimeout(()=>o.innerHTML="Guess the color",1e3),update_cookie(),update_gameinfo()}function log_colors(){for(index in circles)circles.hasOwnProperty(index)&&console.log(parseInt(index)+1,circles[index].style.backgroundColor)}function log_answers(){for(index in circles)circles.hasOwnProperty(index)&&deep_compare(circles[index].style.backgroundColor.slice(4,-1).split(", "),color)&&console.log(parseInt(index)+1)}function text_anim(){null!=g_anim&&clearTimeout(g_anim),$("#guess").style.transform="scale(1.1)",g_anim=setTimeout(()=>$("#guess").style.transform="",1e3)}function full_anim(){for(index in circles)if(circles.hasOwnProperty(index)){const o=circles[index];setTimeout(()=>{o.style.borderRadius="16px",setTimeout(()=>o.style.borderRadius="",200)},200*index)}text_anim()}function update_gameinfo(){if(""==document.cookie)return;let o=JSON.parse(document.cookie.replace(/(?:(?:^|.*;\s*)gtcgame\s*\=\s*([^;]*).*$)|^.*$/,"$1"));wins=o.wins||0,clicks=o.clicks||0,dif=o.dif||255,$("#difficulty").innerHTML=255-dif,$("#win-rate").innerHTML=`<span class="tooltip toggle-tooltip">\n            <span class="tooltip-text">${wins} / ${clicks} ${clicks>1?"tries":"try"}</span>\n        ${Math.round(wins/clicks*100)||"??"}%</span>`}function update_cookie(){document.cookie=`${cookie_name}=${JSON.stringify({dif:dif,clicks:clicks,wins:wins})}; expires=Fri, 31 Dec 9999 23:59:59 GMT`}function copy_color_code(){navigator.clipboard.writeText(last_color).then(()=>toggle_tooltip($("#copied"),$("#copy-tooltip")),o=>console.error("Couldn't copy to clipboard: ",o))}function toggle_tooltip(o,e){let i=!1;(null!=e&&e.classList.contains("toggle-tooltip")||0!=o.style.opacity)&&(i=!0),o.style.opacity=1,o.style.transform="scale(1)",i&&e.classList.remove("toggle-tooltip"),o.parentNode.onmouseleave=(()=>{o.style.opacity=0,o.style.transform="scale(0)",console.log(i),i&&e.classList.add("toggle-tooltip")})}function init(){for(index in $("#reset-arrow").onclick=(()=>{dif=255,clicks=0,wins=0,toggle_tooltip($("#reseted"),$("#reset")),clicked_colors.forEach(o=>o.style.transform=""),clicked_colors=[],update_cookie(),update_gameinfo(),randomize_colors()}),randomize_colors(),$("#difficulty").innerHTML=255-dif,circles)circles.hasOwnProperty(index)&&(circles[index].onclick=verify_color);document.addEventListener("keydown",o=>{if(o.repeat)return;let e=circles[parseInt(o.key)-1];null!=e&&e.click()}),$("#js-enabled").style.display="block",update_gameinfo()}let color,guess_timer,win_timer,g_anim,last_color,dif=255,won=!1,clicks=0,wins=0,clicked_colors=[];const $=o=>{let e=o.slice(0,1);switch("#"!=e&&"."!=e||(o=o.slice(1,o.length)),e){case"#":return document.getElementById(o);case".":return document.getElementsByClassName(o);default:return document.getElementsByTagName(o)}},win_sound=new Audio("assets/win.mp3"),wrong_sound=new Audio("assets/wrong.mp3"),circles=$(".color-circle"),cookie_name="gtcgame",win_msg=["Well done!","Good job!","So smart!"],encouraging=["Don't give up.","Never give up.","You can do it."],rand=(o=0,e=1)=>Math.random()*e+o,rgbToHex=(o,e,i)=>"#"+((1<<24)+(o<<16)+(e<<8)+i).toString(16).slice(1);init();