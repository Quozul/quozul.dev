function changeProgress(e,t="",n=0,o=!1){const s=document.getElementById(e);s.style.width=Math.floor(n)+"%",s.innerHTML=t,o?s.classList.add("bg-danger"):s.classList.remove("bg-danger")}function download(e,t,n,o=!1){let s;if(s=o?e:new Blob([e],{type:n}),window.navigator.msSaveOrOpenBlob)window.navigator.msSaveOrOpenBlob(s,t);else{const e=document.createElement("a"),n=URL.createObjectURL(s);e.href=n,e.download=t,document.body.appendChild(e),e.click(),setTimeout(function(){document.body.removeChild(e),window.URL.revokeObjectURL(n)},0)}}function decrypt(e){const t=this.files[0];if(null!=t){changeProgress("encrypt-progress","",0);const e=new Worker("scripts/decrypt.min.js");changeProgress("decrypt-progress","Loading image...",10);const n=URL.createObjectURL(t),o=new Image;delete t,o.onload=function(){console.log("Image loaded!"),URL.revokeObjectURL(this.src);const t=document.getElementById("decrypt-canvas"),n=t.getContext("2d");t.width=this.width.toString(),t.height=this.height.toString(),t.style.width="100%",changeProgress("decrypt-progress","Drawing image...",20),n.drawImage(this,0,0),changeProgress("decrypt-progress","Getting image data...",30);const s=n.getImageData(0,0,this.width,this.height);changeProgress("decrypt-progress","Starting worker...",40),e.postMessage(s),delete s,delete o},o.src=n,e.onmessage=function(t){switch(t.data[0]){case"progress":changeProgress("decrypt-progress",t.data[1],t.data[2]);break;case"done":changeProgress("decrypt-progress","Done!",100),window.decryptedFile=t.data[1],document.getElementById("download-file").classList.remove("d-none"),delete e}}}}function encrypt(e){const t=this.files[0];if(null!=t){changeProgress("encrypt-progress","",0);const e=new Worker("scripts/encrypt.min.js");e.postMessage(t),delete t,e.onmessage=function(t){switch(t.data[0]){case"progress":changeProgress("encrypt-progress",t.data[1],t.data[2]);break;case"done":changeProgress("encrypt-progress","Done!",100);const n=document.getElementById("encrypt-canvas");n.classList.remove("d-none");const o=n.getContext("2d");n.width=t.data[1].width,n.height=t.data[1].height,n.style.width="100%",o.putImageData(t.data[1],0,0),document.getElementById("download-image").classList.remove("d-none"),delete e}}}}function downloadImage(e){const t=document.getElementById("encrypt-canvas");t.toBlob(function(e){download(e,"image.png","",!0)})}function downloadFile(e){download(window.decryptedFile,"file.txt","")}document.getElementById("encrypt-input").addEventListener("change",encrypt),document.getElementById("decrypt-input").addEventListener("change",decrypt),document.getElementById("download-image").addEventListener("click",downloadImage),document.getElementById("download-file").addEventListener("click",downloadFile);